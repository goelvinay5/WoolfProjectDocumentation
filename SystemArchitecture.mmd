graph TD;
    
    %% API Gateway and Load Balancer
    A["API Gateway"] -->|Routes Requests| B["Product Service"];
    A --> C["Payment Service"];
    A --> D["Notification Service"];
    A --> E["User Service (Auth Server)"];

    %% Product Service (Includes Order & Cart)
    B -->|Uses| F["Elasticsearch"];
    B -->|Stores Data| G["MySQL"];
    B -->|Caches| H["Redis"];
    
    %% Payment Service
    C -->|Sends Events| I["Kafka Message Broker"];

    %% Notification Service
    D -->|Emails| J["Amazon SES"];

    %% User Service (Auth Server)
    E -->|Handles Authentication| K["Spring Security"];
    E -->|Stores Users| L["MySQL"];

    %% Connections
    E -->|Generates Token| A;
    A -->|Validates Token| B;
    A -->|Validates Token| C;
    A -->|Validates Token| D;

    %% Load Balancer
    subgraph Load Balancer
        M["ELB"]
    end
    M --> A;

    %% Caching
    subgraph Caching
        H;
    end

    %% Databases
    subgraph Databases
        G;
        L;
    end

    %% Message Broker
    subgraph Message Broker
        I;
    end

    I -->|Publishes| B;
    I -->|Subscribes| C;
